<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>How to create full calendar in jQuery</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <!----css3---->
    <link rel="stylesheet" href="assets/css/custom.css">
    <!-- SLIDER REVOLUTION 4.x CSS SETTINGS -->
    <link rel="icon" type="image/png" href="assets/img/pharmacie.png"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.1/main.min.css" rel="stylesheet" />
    <!-- JS for jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- JS for full calendar -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

    <!-- CSS Bootstrap -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- JS Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>

    #calendar {
    width: 90%;
    height: 560px;
    margin: 0 auto;
    background-color: white;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    margin-top:40px;
    }

    h1 {
    text-align: center;
    margin-bottom: 30px;
    }

    .modal-dialog {
    max-width: 400px;
    }

    .modal-content {
    border-radius: 8px;
    }

    .modal-header {
    border-bottom: none;
    }

    .modal-body {
    padding: 20px;
    }

    .form-group label {
    font-weight: bold;
    }

    .btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    }

    .btn-primary:hover {
    background-color: #0056b3;
    border-color: #0056b3;
    }
    .fc .fc-toolbar-title {
    font-size: 1.75em;
    margin: 0px;
    color:grey;
}
    .fc .fc-button-primary {
    background-color: #00ADB3;
    border-color: #00ADB3;
    color: var(--fc-button-text-color);
}
    </style>
</head>

<body>
<div class="wrapper">


    <div class="body-overlay"></div>
    <!-- Sidebar  -->
    <nav id="sidebar">
        <div class="sidebar-header">
            <h3><img src="assets/img/pharmacie.png" class="img-fluid"/><span style="color:#005761;">MedConnect</span></h3>
        </div>
        <ul class="list-unstyled components">
            <li >
                <a href="#" class="dashboard"><i class="material-icons">dashboard</i><span>Dashboard</span></a>
            </li>
            <div class="small-screen navbar-display">
                <li class="dropdown d-lg-none d-md-block d-xl-none d-sm-block">
                    <a href="#profileSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                        <i class="material-icons">person</i><span>User</span>
                    </a>
                    <ul class="collapse list-unstyled menu" id="profileSubmenu">
                        <li><a href="#">Profile</a></li>
                        <li><a href="/">Logout</a></li>
                    </ul>
                </li>
            </div>
            <li  class="">
                <a href="#"><i class="material-icons">library_books</i><span>Calender</span></a>
            </li>


        </ul>


    </nav>



    <!-- Page Content  -->
    <div id="content" >
        <div class="top-navbar">
            <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">

                    <button type="button" id="sidebarCollapse" class="d-xl-block d-lg-block d-md-mone d-none">
                        <span class="material-icons">arrow_back_ios</span>
                    </button>

                    <a class="navbar-brand" href="#"> Profile </a>

                    <button class="d-inline-block d-lg-none ml-auto more-button" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="material-icons">more_vert</span>
                    </button>

                    <div class="collapse navbar-collapse d-lg-block d-xl-block d-sm-none d-md-none d-none" id="navbarSupportedContent">
                        <ul class="nav navbar-nav ml-auto">
                            <li class="dropdown nav-item">
                                <a href="#" class="nav-link" data-toggle="dropdown">
                                    <span class="material-icons">person</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a href="#">Profile</a>
                                    </li>
                                    <li>
                                        <a href="/">Logout</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
        <div id="calendar"></div>
        <footer class="footer">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6" style="margin-left:630px;">
                        <p class="copyright d-flex justify-content-end"> © Copyright MedConnect. All Rights Reserved</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</div>
<div class="modal fade" id="doctorModal" tabindex="-1" role="dialog" aria-labelledby="doctorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="doctorModalLabel">Enter Doctor Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="doctorSelect">Doctor Name</label>
                        <select class="form-control" id="doctorSelect">
                            <option value="">Choisissez une spécialité</option>
                            <option th:each="docteur: ${doctors}" th:value="${docteur.id_docteur}" th:text="${docteur.nom + ' ' + docteur.prenom}"></option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="startTimeInput">Start Time</label>
                        <input type="text" class="form-control" id="startTimeInput">
                    </div>
                    <div class="form-group">
                        <label for="endTimeInput">End Time</label>
                        <input type="text" class="form-control" id="endTimeInput">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="saveDoctorBtn">Save</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
           var calendarEl = document.getElementById('calendar');
           var calendar = new FullCalendar.Calendar(calendarEl, {
               initialView: 'dayGridMonth',
               editable: true,
               selectable: true,
               events: [
                   // Vos événements existants ici
               ],
               dateClick: function(info) {
                   $('#doctorModal').modal('show');

                   $('#saveDoctorBtn').on('click', function() {
                       var doctorId = $('#doctorSelect').val();
                       var startTime = $('#startTimeInput').val();
                       var endTime = $('#endTimeInput').val();
                       var selectedDate = info.dateStr; // Récupérer la date sélectionnée dans le calendrier

                       if (doctorId && startTime && endTime && selectedDate) {
                           $.ajax({
                               url: '/api/horaires',
                               type: 'POST',
                               contentType: 'application/json',
                               data: JSON.stringify({
                                   doctorId: doctorId,
                                   startTime: startTime,
                                   endTime: endTime,
                                   date: selectedDate // Envoyer la date sélectionnée dans la requête
                               }),
                               success: function(response) {
                                   // Ajouter l'événement au calendrier côté frontend
                                   calendar.addEvent({
                                       title: response.title,
                                       start: response.start,
                                       end: response.end
                                   });

                                   // Rafraîchir le calendrier pour afficher le nouvel événement
                                   calendar.refetchEvents();

                                   // Masquer le modal
                                   $('#doctorModal').modal('hide');
                               },
                               error: function() {
                                   alert('Failed to save doctor');
                               }
                           });
                       } else {
                           alert('Please fill in all fields');
                       }
                   });
               }
           });

           calendar.render();
       });

    </script>
<script src="assets/js/Dashboard.js"></script>
</body>
</html>
